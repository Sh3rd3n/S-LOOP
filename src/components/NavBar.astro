---
const links = Astro.props.links || [];

let baseUrl = import.meta.env.url;
// let baseUrl = Astro.site;
let pathLang = Astro.url.pathname.split('/')[1] || 'it';
---

<nav class="fixed z-20 w-full">
    <div id="nav-header" class="flex justify-between items-center md:bg-gradient-to-b md:from-black/70">
        <a href="#hero" aria-label="Go to hero section" class="w-44 md:w-36 lg:w-44 flex justify-center items-center">
            <img id="school-logo"
                 class="size-44 md:size-36 lg:size-44 aspect-square p-10 md:p-8 lg:p-10 transition-all duration-500"
                 src="/sloop-logo.webp" alt="S-LOOP Kiteboarding School" />
        </a>

        <div id="links-bar" class="hidden md:flex justify-center items-center gap-6 lg:gap-10">
            {links.map((link: any) => (<a href={link.href} aria-label={`Go to ${link.label} section`}
                                          class="font-light md:text-white md:text-2xl lg:text-3xl whitespace-nowrap">{link.label}</a>))}
        </div>

        <div class="md:hidden flex justify-center items-center w-28 lg:w-44">
            <button id="mobile-menu-button" type="button" class="h-8 w-10 text-white group" role="switch"
                    aria-checked="false" aria-label="Toggle mobile menu">
                <span class="relative flex overflow-hidden items-center justify-center size-full transform transition-all duration-200">
                    <span class="flex flex-col justify-between size-full transform transition-all duration-300 origin-center overflow-hidden">
                        <span class="bg-white h-0.5 w-10 transform transition-all duration-300 origin-left group-aria-checked:translate-y-10 delay-100"></span>
                        <span class="bg-white h-0.5 w-10 rounded transform transition-all duration-300 group-aria-checked:translate-y-10 delay-75"></span>
                        <span class="bg-white h-0.5 w-10 transform transition-all duration-300 origin-left group-aria-checked:translate-y-10"></span>

                        <span class="absolute flex items-center justify-between pt-4 transform transition-all duration-500 -translate-x-12 group-aria-checked:translate-x-0">
                            <span class="absolute bg-white h-0.5 w-10 transform transition-all duration-500 rotate-0 delay-300 group-aria-checked:rotate-45"></span>
                            <span class="absolute bg-white h-0.5 w-10 transform transition-all duration-500 -rotate-0 delay-300 group-aria-checked:-rotate-45"></span>
                        </span>
                    </span>
                </span>
            </button>
        </div>

        <div class="hidden md:flex justify-center items-center w-44 md:w-36 lg:w-44">
            <div id="languageSelector"
                 class="dropdown md:flex justify-center items-center size-44 md:size-36 lg:size-44">
                <div class="relative inline-block ">
                    <button class="dropbtn text-2xl transition-all duration-150"><span class=`fi fi-${pathLang}`></span></button>
                    <div class="hidden dropdown-content absolute mt-2 -translate-x-1/3 w-fit text-nowrap shadow-lg bg-black bg-opacity-85 animate-fade animate-duration-300">
                        <a href={baseUrl} data-value="it"
                           class="block px-4 py-2 text-sm text-white hover:text-black hover:bg-teal"><span
                                class="fi fi-it mr-4"></span> Italiano</a>
                        <a href=`${baseUrl}/gb` data-value="gb"
                           class="block px-4 py-2 text-sm text-white hover:text-black hover:bg-teal"><span
                                class="fi fi-gb mr-4"></span> English</a>
                        <a href=`${baseUrl}/es` data-value="es"
                           class="block px-4 py-2 text-sm text-white hover:text-black hover:bg-teal"><span
                                class="fi fi-es mr-4"></span> Español</a>
                        <a href=`${baseUrl}/fr` data-value="fr"
                           class="block px-4 py-2 text-sm text-white hover:text-black hover:bg-teal"><span
                                class="fi fi-fr mr-4"></span> Français</a>
                        <a href=`${baseUrl}/de` data-value="de"
                           class="block px-4 py-2 text-sm text-white hover:text-black hover:bg-teal"><span
                                class="fi fi-de mr-4"></span> Deutsch</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="mobile-menu" class="hidden md:hidden bg-black bg-opacity-85">
        <div class="flex flex-col gap-2 p-2">
            {links.map((link: any) => (
                    <a href={link.href} aria-label={`Go to ${link.label} section`}
                       class="block px-3 py-2 text-white hover:text-black text-xl sm:text-2xl font-medium hover:bg-teal animate-fade-down animate-once animate-ease-out">
                        {link.label}
                    </a>
            ))}

            <button class="menu-dropbtn text-2xl transition-all duration-150 block px-3 py-2 text-left text-white hover:text-black sm:text-2xl font-medium animate-fade-down animate-once animate-ease-out">
                <span class=`fi fi-${pathLang}`></span></button>

            <div class="hidden menu-dropdown-content mt-2 text-nowrap shadow-lg animate-fade animate-duration-300">
                <div class="flex flex-row w-full justify-around items-center p-2">
                    <a href={baseUrl} data-value="it" class="block text-xl" aria-label="Italiano"><span
                            class="fi fi-it"></span></a>
                    <a href=`${baseUrl}/gb` data-value="gb" class="block text-xl" aria-label="English"><span
                            class="fi fi-gb"></span></a>
                    <a href=`${baseUrl}/es` data-value="es" class="block text-xl" aria-label="Español"><span
                            class="fi fi-es"></span></a>
                    <a href=`${baseUrl}/fr` data-value="fr" class="block text-xl" aria-label="Français"><span
                            class="fi fi-fr"></span></a>
                    <a href=`${baseUrl}/de` data-value="de" class="block text-xl" aria-label="Deutsch"><span
                            class="fi fi-de"></span></a>
                </div>
            </div>
        </div>
    </div>
</nav>

<script is:inline>
    let scrolled = false;
    let menuOpen = false;

    const baseLogoSize = "size-44 md:size-36 lg:size-44 p-10 md:p-8 lg:p-10"
    const smallLogoSize = "size-20 md:size-16 lg:size-24 p-2 md:p-1 lg:p-2" // Change the menu size when the user scrolls

    const navHeader = document.getElementById('nav-header');
    const navMenu = document.getElementById("mobile-menu");
    const button = document.getElementById('mobile-menu-button');
    const logo = document.getElementById('school-logo');
    const languageSelector = document.getElementById('languageSelector');

    const dropbtn = document.querySelector('.dropbtn');
    const dropdownContent = document.querySelector('.dropdown-content');
    const menuDropbtn = document.querySelector('.menu-dropbtn');
    const menuDropdownContent = document.querySelector('.menu-dropdown-content');

    function toggleButtonState(button) {
        const isChecked = button.getAttribute('aria-checked') === 'true';
        button.setAttribute('aria-checked', isChecked ? 'false' : 'true');
        document.body.style.overflow = isChecked ? 'auto' : 'hidden';
    }

    function closeMenu(button) {
        toggleButtonState(button);
        navHeader.classList.remove('!bg-black', '!bg-opacity-85');
        navMenu.classList.add('hidden');
        menuOpen = false;
    }

    function openMenu(button) {
        toggleButtonState(button);
        navHeader.classList.add('!bg-black', '!bg-opacity-85');
        navMenu.classList.remove('hidden');
        menuOpen = true;
    }

    function handleScroll(isScrolled) {
        navHeader.classList.toggle('animate-shrink-navbar', isScrolled);
        navHeader.classList.toggle('animate-expand-navbar', !isScrolled);
        scrolled = isScrolled;
    }

    function updateHeaderSize() {
        const classListToRemove = scrolled ? baseLogoSize : smallLogoSize;
        const classListToAdd = scrolled ? smallLogoSize : baseLogoSize;

        classListToRemove.split(" ").forEach(cls => {
            logo.classList.remove(cls);
            languageSelector.classList.remove(cls);
        });

        classListToAdd.split(" ").forEach(cls => {
            logo.classList.add(cls);
            languageSelector.classList.add(cls);
        });
    }

    function toggleDropdownContent(dropdownContent, dropbtn) {
        dropdownContent.classList.toggle('hidden');
        dropbtn.classList.toggle('-translate-y-1');
        dropbtn.classList.toggle('drop-shadow-lg');
    }

    function closeIfClickedOutside(dropdownContent, dropbtn) {
        document.addEventListener('click', function (event) {
            if (!dropbtn.contains(event.target) && !dropdownContent.contains(event.target)) {
                dropdownContent.classList.add('hidden');
                dropbtn.classList.remove('-translate-y-1');
                dropbtn.classList.remove('drop-shadow-lg');
            }
        });
    }

    button.addEventListener('click', function () {
        menuOpen ? closeMenu(this) : openMenu(this);
    });

    window.addEventListener('scroll', () => {
        handleScroll(window.scrollY > 0)
        updateHeaderSize();
    });

    document.addEventListener('click', (event) => {
        if (menuOpen
            && !navHeader.contains(event.target)
            && !menuDropbtn.contains(event.target)
            && !menuDropdownContent.contains(event.target)
        )
            closeMenu(button);
    });

    dropbtn.addEventListener('click', function () {
        toggleDropdownContent(dropdownContent, dropbtn);
        closeIfClickedOutside(dropdownContent, dropbtn);
    });

    menuDropbtn.addEventListener('click', function () {
        toggleDropdownContent(menuDropdownContent, menuDropbtn);
        closeIfClickedOutside(menuDropdownContent, menuDropbtn);
        menuDropbtn.classList.toggle("hover:bg-teal")
    });
</script>